<!DOCTYPE html>
<html>
<head>
    <title>KPI Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        h1 { text-align: center; margin-bottom: 40px; }
        .chart-container { 
            width: 45%; 
            height: 400px;
            display: inline-block; 
            margin: 15px; 
            vertical-align: top; 
        }
    </style>
</head>
<body>
    <h1>Employee KPI Dashboard (SAP + Jira + GitLab)</h1>

    <!-- First 5 -->
    <div class="chart-container"><canvas id="attendanceChart"></canvas></div>
    <div class="chart-container"><canvas id="ticketsChart"></canvas></div>
    <div class="chart-container"><canvas id="commitsChart"></canvas></div>
    <div class="chart-container"><canvas id="leavesChart"></canvas></div>
    <div class="chart-container"><canvas id="bugsChart"></canvas></div>

    <!-- Extra 10 -->
    <div class="chart-container"><canvas id="overtimeChart"></canvas></div>
    <div class="chart-container"><canvas id="effectiveDaysChart"></canvas></div>
    <div class="chart-container"><canvas id="attendanceRateChart"></canvas></div>
    <div class="chart-container"><canvas id="storyPointsChart"></canvas></div>
    <div class="chart-container"><canvas id="closeTimeChart"></canvas></div>
    <div class="chart-container"><canvas id="reopenedChart"></canvas></div>
    <div class="chart-container"><canvas id="mergeRequestsChart"></canvas></div>
    <div class="chart-container"><canvas id="reviewsChart"></canvas></div>
    <div class="chart-container"><canvas id="deploymentsChart"></canvas></div>
    <div class="chart-container"><canvas id="buildFailChart"></canvas></div>

    <script>
        const labels = {{ employees|safe }};
        const attendance = {{ attendance|safe }};
        const tickets = {{ tickets|safe }};
        const commits = {{ commits|safe }};
        const leaves = {{ leaves|safe }};
        const bugs = {{ bugs|safe }};
        const overtime = {{ overtime|safe }};
        const effective_days = {{ effective_days|safe }};
        const attendance_rate = {{ attendance_rate|safe }};
        const story_points = {{ story_points|safe }};
        const close_time = {{ close_time|safe }};
        const reopened = {{ reopened|safe }};
        const merge_requests = {{ merge_requests|safe }};
        const reviews = {{ reviews|safe }};
        const deployments = {{ deployments|safe }};
        const build_fail = {{ build_fail|safe }};

        // Reusable chart function
        function makeChart(id, type, data, label, title, colors=null) {
            new Chart(document.getElementById(id), {
                type: type,
                data: {
                    labels: labels,
                    datasets: [{
                        label: label,
                        data: data,
                        backgroundColor: colors || 'blue',
                        borderColor: colors || 'blue',
                        fill: type === 'line' ? false : true
                    }]
                },
                options: {
                    plugins: {
                        title: { display: true, text: title, font: { size: 16 } }
                    },
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        // First 5
        makeChart("attendanceChart", "bar", attendance, "Attendance Days", "Attendance (SAP) - Total Days Present");
        makeChart("ticketsChart", "line", tickets, "Tickets Closed", "Tickets Closed per Employee (Jira)", "green");
        makeChart("commitsChart", "pie", commits, "Commits", "Code Commits Distribution (GitLab)", 
                  ['red','orange','yellow','green','blue','purple','pink','cyan','lime','brown']);
        makeChart("leavesChart", "doughnut", leaves, "Leaves Taken", "Leave Utilization (SAP)", 
                  ['#ff6384','#36a2eb','#ffce56','#4bc0c0','#9966ff','#ff9f40','#66ff66','#ff6699','#0099cc','#cc9900']);
        makeChart("bugsChart", "radar", bugs, "Bugs Fixed", "Bugs Fixed (Jira + GitLab)", "red");

        // Extra 10
        makeChart("overtimeChart", "bar", overtime, "Overtime Hours", "Overtime Hours (SAP)", "orange");
        makeChart("effectiveDaysChart", "line", effective_days, "Effective Days", "Effective Working Days (SAP)", "blue");
        makeChart("attendanceRateChart", "radar", attendance_rate, "Attendance %", "Attendance Consistency Rate (%)", "teal");
        makeChart("storyPointsChart", "bar", story_points, "Story Points", "Story Points Delivered (Jira)", "purple");
        makeChart("closeTimeChart", "line", close_time, "Avg Close Time", "Average Time to Close Tickets (Jira)", "brown");
        makeChart("reopenedChart", "doughnut", reopened, "Reopened %", "Reopened Tickets % (Jira)", 
                  ['#ff9999','#66b3ff','#99ff99','#ffcc99','#c2c2f0','#ffb3e6','#c2d6d6','#ff6666','#66ff66','#99e6e6']);
        makeChart("mergeRequestsChart", "bar", merge_requests, "Merge Requests", "Merge Requests Created (GitLab)", "darkgreen");
        makeChart("reviewsChart", "pie", reviews, "Reviews", "Code Review Participation (GitLab)", 
                  ['#e6194B','#3cb44b','#ffe119','#4363d8','#f58231','#911eb4','#42d4f4','#f032e6','#bfef45','#fabebe']);
        makeChart("deploymentsChart", "line", deployments, "Deployments", "Deployment Frequency (GitLab)", "navy");
        makeChart("buildFailChart", "radar", build_fail, "Build Fail %", "Build Failure Rate (GitLab CI)", "maroon");
    </script>
</body>
</html>
